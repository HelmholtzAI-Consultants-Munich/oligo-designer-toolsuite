name: test

on:
  push:
    branches:
      - main
    paths-ignore:
      - 'README.md'
      - 'pyproject.toml'
      - 'docs/**'
      - 'tutorials/**'
  pull_request:
    branches:
      - main
    paths-ignore:
      - 'README.md'
      - 'pyproject.toml'
      - 'docs/**'
      - 'tutorials/**'
      - '.github/workflows/**'
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        python-version: ["3.10"]

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v3

      - name: Setup Conda for Ubuntu
        uses: conda-incubator/setup-miniconda@v2
        with:
          miniconda-version: "latest"
          python-version: ${{ matrix.python-version }}
          activate-environment: "test-env"

      - name: Install Dependencies
        run: |
          conda config --add channels bioconda
          conda config --add channels conda-forge
          conda install -n test-env -y "blast>=2.15.0" "bedtools>=2.30" "bowtie>=1.3.1" "bowtie2>=2.5"
          conda activate test-env
          python -m pip install --upgrade pip
          pip install pytest
          pip install -e .

      - name: Test with pytest
        run: |
          pytest tests/test_oligo_specificity_filter.py
